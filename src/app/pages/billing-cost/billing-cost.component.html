<div class="container my-4">
  <h3 class="mb-3">Monthly Billing</h3>

  <!-- âœ… Entire form wrapped in [formGroup] -->
  <form [formGroup]="billingForm">
    <!-- Global Billing Month Selector -->
    <div class="row g-3 align-items-end mb-4">
      <div class="col-md-4">
        <label>Billing Month</label>
        <input type="month" class="form-control" formControlName="billingMonth" />
      </div>
      <div class="col-md-4">
        <button class="btn btn-success" type="button" (click)="submitAllBills()">
          ðŸ’¾ Submit All Bills
        </button>
      </div>
    </div>

    <!-- âœ… Correct use of formArrayName inside formGroup -->
    <div formArrayName="flats">
      <div
        class="card p-3 mb-4"
        *ngFor="let flat of flats.controls; let i = index"
        [formGroupName]="i"
      >
        <h5 class="mb-3">Flat {{ flat.value.flatId }} â€” {{ flat.value.tenantName }}</h5>

        <div class="row g-3">
          <div class="col-md-4">
            <label>Rent</label>
            <input class="form-control" formControlName="rentAmount"  />
          </div>
              <ng-container *ngIf="flat.value.servicesUsed.electricity">
            <div class="col-md-4">
              <label>Previous Unit</label>
              <input type="number" formControlName="previousUnit" class="form-control" />
            </div>
            <div class="col-md-4">
              <label>Current Unit</label>
              <input type="number" formControlName="currentUnit" class="form-control" />
            </div>
            <div class="col-md-4">
              <label>Electricity Cost (â‚¹)</label>
              <input class="form-control" formControlName="electricityCost"  />
            </div>
          </ng-container>

          <ng-container *ngIf="flat.value.servicesUsed.parking">
            <div class="col-md-4">
              <label>Parking (â‚¹)</label>
              <input type="number" formControlName="parking" class="form-control" />
            </div>
          </ng-container>

          <ng-container *ngIf="flat.value.servicesUsed.wifi">
            <div class="col-md-4">
              <label>Wifi (â‚¹)</label>
              <input type="number" formControlName="wifi" class="form-control" />
            </div>
          </ng-container>

          <ng-container *ngIf="flat.value.servicesUsed.maintenance">
            <div class="col-md-4">
              <label>Maintenance (â‚¹)</label>
              <input type="number" formControlName="maintenance" class="form-control" />
            </div>
          </ng-container>

          <ng-container *ngIf="flat.value.servicesUsed.water">
            <div class="col-md-4">
              <label>Water (â‚¹)</label>
              <input type="number" formControlName="water" class="form-control" />
            </div>
          </ng-container>

      

          <div class="col-md-4 mt-2">
            <label>Total Amount (â‚¹)</label>
            <input class="form-control fw-bold text-success" formControlName="total"  />
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
